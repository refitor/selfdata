{"version":3,"file":"index.js","sources":["../../../../node_modules/@vue/babel-helper-vue-jsx-merge-props/dist/helper.js","../../../../packages/utils/lib/toarray.js","../src/component.jsx","../../../../node_modules/style-inject/dist/style-inject.es.js","../../../../packages/utils/lib/slot.js","../src/index.js"],"sourcesContent":["\"use strict\";function _extends(){return _extends=Object.assign||function(a){for(var b,c=1;c<arguments.length;c++)for(var d in b=arguments[c],b)Object.prototype.hasOwnProperty.call(b,d)&&(a[d]=b[d]);return a},_extends.apply(this,arguments)}var normalMerge=[\"attrs\",\"props\",\"domProps\"],toArrayMerge=[\"class\",\"style\",\"directives\"],functionalMerge=[\"on\",\"nativeOn\"],mergeJsxProps=function(a){return a.reduce(function(c,a){for(var b in a)if(!c[b])c[b]=a[b];else if(-1!==normalMerge.indexOf(b))c[b]=_extends({},c[b],a[b]);else if(-1!==toArrayMerge.indexOf(b)){var d=c[b]instanceof Array?c[b]:[c[b]],e=a[b]instanceof Array?a[b]:[a[b]];c[b]=d.concat(e)}else if(-1!==functionalMerge.indexOf(b)){for(var f in a[b])if(c[b][f]){var g=c[b][f]instanceof Array?c[b][f]:[c[b][f]],h=a[b][f]instanceof Array?a[b][f]:[a[b][f]];c[b][f]=g.concat(h)}else c[b][f]=a[b][f];}else if(\"hook\"==b)for(var i in a[b])c[b][i]=c[b][i]?mergeFn(c[b][i],a[b][i]):a[b][i];else c[b]=a[b];return c},{})},mergeFn=function(a,b){return function(){a&&a.apply(this,arguments),b&&b.apply(this,arguments)}};module.exports=mergeJsxProps;\n","export default function toArray(value) {\n    return Array.isArray(value)\n        ? value\n        : ([null, undefined, ''].indexOf(value) > -1 ? [] : [value]);\n}\n","import toArray from '@form-create/utils/lib/toarray';\nimport './style.css';\nimport getSlot from '@form-create/utils/lib/slot';\n\nfunction parseFile(file) {\n    return {\n        url: file,\n        name: getFileName(file)\n    };\n}\n\nfunction getFileName(file) {\n    return ('' + file).split('/').pop()\n}\n\nconst NAME = 'fcUpload';\n\n\nexport default function createUpload(config) {\n    return {\n        name: NAME,\n        props: {\n            formCreateInject: {\n                type: Object,\n                required: true,\n            },\n            onHandle: {\n                type: Function,\n                default(file) {\n                    this.previewImage = file.url;\n                    this.previewVisible = true;\n                }\n            },\n            uploadType: {\n                type: String,\n                default: 'file'\n            },\n            maxLength: {\n                type: Number,\n                default: 0\n            },\n            allowRemove: {\n                type: Boolean,\n                default: true\n            },\n            modalTitle: String,\n            handleIcon: {\n                type: [String, Boolean],\n                default: () => undefined\n            },\n            value: [Array, String]\n        },\n        data() {\n            return {\n                uploadList: [],\n                previewVisible: false,\n                previewImage: '',\n                cacheFiles:[],\n            }\n        },\n        created() {\n            if (this.formCreateInject.prop.props.showUploadList === undefined)\n                this.formCreateInject.prop.props.showUploadList = false;\n            this.formCreateInject.prop.props.defaultFileList = toArray(this.value).map(parseFile);\n        },\n        watch: {\n            value(n) {\n                if (this.$refs.upload.fileList.every(file => {\n                    return !file.status || file.status === 'finished';\n                })) {\n                    this.$refs.upload.fileList = toArray(n).map(parseFile);\n                    this.uploadList = this.$refs.upload.fileList;\n                }\n            },\n            maxLength(n, o) {\n                if (o === 1 || n === 1)\n                    this.update();\n            }\n        },\n        methods: {\n            key(unique) {\n                return unique;\n            },\n            isDisabled() {\n                return this.formCreateInject.prop.props.disabled === true;\n            },\n            onRemove(file) {\n                if (this.isDisabled()) return;\n                this.$refs.upload.handleRemove(file);\n            },\n            handleClick(file) {\n                this.onHandle(file);\n            },\n            makeItem(file, index) {\n                return this.uploadType === 'image'\n                    ? <img src={file.url} key={this.key('img' + index)}/>\n                    : <icon props={{type: config.fileIcon, size: 40}} key={this.key('i' + index)}/>\n            },\n            makeRemoveIcon(file, index) {\n                return <icon type='ios-trash-outline' on-click={() => this.onRemove(file)}\n                    key={this.key('ri' + index)}/>;\n            },\n            makeHandleIcon(file, index) {\n                return <icon\n                    type={(this.handleIcon === true || this.handleIcon === undefined) ? 'ios-eye-outline' : this.handleIcon}\n                    on-click={() => this.handleClick(file)} key={this.key('hi' + index)}/>;\n            },\n            makeProgress(file, index) {\n                return <Progress props={{percent: file.percentage, hideInfo: true}} style=\"width:90%\"\n                    key={this.key('pg' + index)}/>\n            },\n            makeIcons(file, index) {\n                const icons = [];\n                if (this.allowRemove || this.handleIcon !== false) {\n                    if ((this.uploadType !== 'file' && this.handleIcon !== false) || (this.uploadType === 'file' && this.handleIcon))\n                        icons.push(this.makeHandleIcon(file, index));\n                    if (this.allowRemove)\n                        icons.push(this.makeRemoveIcon(file, index));\n\n                    return <div class=\"fc-upload-cover\">{icons}</div>;\n                }\n            },\n            makeFiles() {\n                return this.uploadList.map((file, index) => this.$scopedSlots.fileList ? this.$scopedSlots.fileList({\n                    file,\n                    index,\n                    vm: this\n                }) : <div key={this.key(index)}\n                    class=\"fc-files\">{file.showProgress ? this.makeProgress(file, index) : [this.makeItem(file, index), this.makeIcons(file, index)]}</div>);\n            },\n            makeUpload() {\n                const isShow = (!this.maxLength || this.maxLength > this.uploadList.length);\n                return <Upload {...this.formCreateInject.prop} ref=\"upload\"\n                    style={{display: 'inline-block'}}\n                    key={this.key('upload')}>\n                    {isShow ? <template slot=\"default\">\n                        {this.$slots.default || <div class=\"fc-upload-btn\">\n                            <icon props={{\n                                type: this.uploadType === 'file' ? 'ios-cloud-upload-outline' : config.imgUpIcon,\n                                size: 20\n                            }}/>\n                        </div>}\n                    </template> : null}{getSlot(this.$slots,['default'])}\n                </Upload>;\n            },\n            update() {\n                let files = this.$refs.upload.fileList.map((file) => file.url).filter((url) => url !== undefined);\n                if(this.cacheFiles.length !== files.length){\n                    this.cacheFiles = [...files];\n                    this.$emit('input', this.maxLength === 1 ? (files[0] || '') : files);\n                }\n            },\n            handleCancel() {\n                this.previewVisible = false;\n            },\n        },\n        render() {\n            if (this.$refs.upload) {\n                if (this.formCreateInject.prop.props.showUploadList === undefined)\n                    this.formCreateInject.prop.props.showUploadList = this.$refs.upload.showUploadList;\n                this.formCreateInject.prop.props.defaultFileList = this.$refs.upload.defaultFileList;\n            }\n            return (\n                <div\n                    class=\"_fc-upload\">{[this.formCreateInject.prop.props.showUploadList ? [] : this.makeFiles(), this.makeUpload()]}\n                    <Modal title={this.modalTitle} v-model={this.previewVisible} footerHide={true}>\n                        <img alt=\"example\" style=\"width: 100%\" src={this.previewImage}/>\n                    </Modal>\n                </div>);\n        },\n        mounted() {\n            this.uploadList = this.$refs.upload.fileList;\n            this.$watch(() => this.$refs.upload.fileList, () => {\n                this.update();\n            }, {deep: true});\n        }\n    };\n}\n","function styleInject(css, ref) {\n  if ( ref === void 0 ) ref = {};\n  var insertAt = ref.insertAt;\n\n  if (!css || typeof document === 'undefined') { return; }\n\n  var head = document.head || document.getElementsByTagName('head')[0];\n  var style = document.createElement('style');\n  style.type = 'text/css';\n\n  if (insertAt === 'top') {\n    if (head.firstChild) {\n      head.insertBefore(style, head.firstChild);\n    } else {\n      head.appendChild(style);\n    }\n  } else {\n    head.appendChild(style);\n  }\n\n  if (style.styleSheet) {\n    style.styleSheet.cssText = css;\n  } else {\n    style.appendChild(document.createTextNode(css));\n  }\n}\n\nexport default styleInject;\n","export default function getSlot(slots, exclude) {\n    return Object.keys(slots).reduce((lst, name) => {\n        if (!exclude || exclude.indexOf(name) === -1) {\n            lst.push(slots[name])\n        }\n        return lst;\n    }, [])\n}","import createUpload from './component';\n\nconst upload = createUpload({\n\n    fileIcon: 'md-document',\n    imgUpIcon: 'md-images',\n});\n\nupload.v2 = createUpload({\n\n    fileIcon: 'document-text',\n    imgUpIcon: 'image',\n});\n\nexport default upload;\n"],"names":["_extends","Object","assign","a","b","c","arguments","length","d","prototype","hasOwnProperty","call","apply","this","normalMerge","toArrayMerge","functionalMerge","mergeFn","reduce","indexOf","Array","e","concat","f","g","h","i","toArray","value","isArray","undefined","parseFile","file","url","name","getFileName","split","pop","css","ref","insertAt","document","head","getElementsByTagName","style","createElement","type","firstChild","insertBefore","appendChild","styleSheet","cssText","createTextNode","NAME","createUpload","config","props","formCreateInject","required","onHandle","Function","previewImage","previewVisible","uploadType","String","maxLength","Number","allowRemove","Boolean","modalTitle","handleIcon","data","uploadList","cacheFiles","created","prop","showUploadList","defaultFileList","map","watch","n","$refs","upload","fileList","every","status","o","update","methods","key","unique","isDisabled","disabled","onRemove","handleRemove","handleClick","makeItem","index","fileIcon","size","makeRemoveIcon","_this","makeHandleIcon","_this2","makeProgress","percent","percentage","hideInfo","makeIcons","icons","push","makeFiles","_this3","$scopedSlots","vm","showProgress","makeUpload","slots","exclude","isShow","display","$slots","imgUpIcon","keys","lst","files","filter","$emit","handleCancel","render","_this4","mounted","$watch","_this5","deep","v2"],"mappings":"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"}