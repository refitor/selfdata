{"remainingRequest":"/home/jery/Desktop/dev/rshub/product/rsapp/selfdata/web/node_modules/_vue-loader@15.9.8@vue-loader/lib/index.js??vue-loader-options!/home/jery/Desktop/dev/rshub/product/rsapp/selfdata/web/src/pages/auth.vue?vue&type=style&index=0&lang=less&","dependencies":[{"path":"/home/jery/Desktop/dev/rshub/product/rsapp/selfdata/web/src/pages/auth.vue","mtime":1653311932831},{"path":"/home/jery/Desktop/dev/rshub/product/rsapp/selfdata/web/node_modules/_css-loader@3.6.0@css-loader/dist/cjs.js","mtime":1651945326012},{"path":"/home/jery/Desktop/dev/rshub/product/rsapp/selfdata/web/node_modules/_vue-loader@15.9.8@vue-loader/lib/loaders/stylePostLoader.js","mtime":1651945387601},{"path":"/home/jery/Desktop/dev/rshub/product/rsapp/selfdata/web/node_modules/_postcss-loader@3.0.0@postcss-loader/src/index.js","mtime":1651945377225},{"path":"/home/jery/Desktop/dev/rshub/product/rsapp/selfdata/web/node_modules/_less-loader@5.0.0@less-loader/dist/cjs.js","mtime":1651945212459},{"path":"/home/jery/Desktop/dev/rshub/product/rsapp/selfdata/web/node_modules/_cache-loader@4.1.0@cache-loader/dist/cjs.js","mtime":1651945230823},{"path":"/home/jery/Desktop/dev/rshub/product/rsapp/selfdata/web/node_modules/_vue-loader@15.9.8@vue-loader/lib/index.js","mtime":1651945387533}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ci5hdXRoTW9kYWwgewogICAgYmFja2dyb3VuZDogdXJsKCcuLi8uLi9wdWJsaWMvYXNzZXRzL2ltZy9sb2dpbi5qcGcnKSBjZW50ZXIgY2VudGVyOwogICAgYmFja2dyb3VuZC1zaXplOiBjb3ZlcjsKfQoubGF5b3V0ewogICAgY29sb3I6ICNmZmY7CiAgICBmb250LXNpemU6IDE1cHg7CiAgICAvKiBib3JkZXI6IDFweCBzb2xpZCAjZDdkZGU0OyAqLwogICAgcG9zaXRpb246IHJlbGF0aXZlOwoJYm9yZGVyLXJhZGl1czogNHB4OwoJb3ZlcmZsb3c6IGhpZGRlbjsKCXdpZHRoOiAxMDAlOwoJdGV4dC1hbGlnbjogY2VudGVyOwp9Ci5sYXlvdXQtY29udGVudC1jZW50ZXJ7CiAgICBkaXNwbGF5OiBpbmxpbmUtYmxvY2s7CiAgICAKICAgIG1hcmdpbi10b3A6IDEwJTsKCgltYXgtd2lkdGg6IDUwMHB4Owp9Ci5xcmNvZGV7CiAgICBkaXNwbGF5OiBpbmxpbmUtYmxvY2s7CglwYWRkaW5nLXRvcDogMjBweDsKCgkvKiBpbWcgewoJCXdpZHRoOiAxNTBweDsKCQloZWlnaHQ6IDE1MHB4OwoJCWJhY2tncm91bmQtY29sb3I6ICNmZmY7CgkJcGFkZGluZzogNnB4OwoJCWJveC1zaXppbmc6IGJvcmRlci1ib3g7Cgl9OyAqLwp9Cg=="},{"version":3,"sources":["auth.vue"],"names":[],"mappings":";AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"auth.vue","sourceRoot":"src/pages","sourcesContent":["<style lang=\"less\">\n.authModal {\n    background: url('../../public/assets/img/login.jpg') center center;\n    background-size: cover;\n}\n.layout{\n    color: #fff;\n    font-size: 15px;\n    /* border: 1px solid #d7dde4; */\n    position: relative;\n\tborder-radius: 4px;\n\toverflow: hidden;\n\twidth: 100%;\n\ttext-align: center;\n}\n.layout-content-center{\n    display: inline-block;\n    \n    margin-top: 10%;\n\n\tmax-width: 500px;\n}\n.qrcode{\n    display: inline-block;\n\tpadding-top: 20px;\n\n\t/* img {\n\t\twidth: 150px;\n\t\theight: 150px;\n\t\tbackground-color: #fff;\n\t\tpadding: 6px;\n\t\tbox-sizing: border-box;\n\t}; */\n}\n</style>\n<template>\n\t<div>\n\t\t<div v-show=\"showModal\" class=\"authModal\">\n\t\t\t<Modal\n\t\t\t\twidth=\"375\"\n\t\t\t\t:closable=\"false\"\n\t\t\t\tv-model=\"authModal\"\n\t\t\t\t:mask=\"true\"\n\t\t\t\t:mask-closable=\"false\"\n\t\t\t\tclass-name=\"vertical-center-modal\">\n\t\t\t\t<h4 id=\"authTitle\" style=\"text-align: center; margin-top: 5px;\">{{$t(\"lang.authTitle\")}}</h4>\n\t\t\t\t<div slot=\"footer\" style=\"text-align: center; margin-bottom: 15px;\">\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<Row v-if=\"!authByPwd\">\n\t\t\t\t\t\t\t<Col span=\"16\">\n\t\t\t\t\t\t\t\t<Input v-model=\"authMail\" type=\"email\" :placeholder=\"$t('lang.inputEmail')\"><span slot=\"prepend\">{{$t(\"lang.email\")}}</span></Input>\n\t\t\t\t\t\t\t</Col>\n\t\t\t\t\t\t\t<Col span=\"4\">\n\t\t\t\t\t\t\t\t<Button id=\"authBtn\" type=\"primary\" @click=\"authCodeSend()\" style=\"margin-left: 10px\">{{$t(\"lang.sendCode\")}}</Button>\n\t\t\t\t\t\t\t</Col>\n\t\t\t\t\t\t</Row>\n\t\t\t\t\t\t<Input v-if=\"!authByPwd\" v-model=\"authCode\" type=\"password\" :placeholder=\"$t('lang.inputCode')\" style=\"margin-top: 15px;\"><span slot=\"prepend\">{{$t(\"lang.code\")}}</span></Input>\n\t\t\t\t\t\t<Input v-if=\"authByPwd\" v-model=\"authMail\" type=\"email\" :placeholder=\"$t('lang.inputEmail')\"><span slot=\"prepend\">{{$t(\"lang.email\")}}</span></Input>\n\t\t\t\t\t\t<Input v-if=\"authByPwd\" v-model=\"authCode\" type=\"password\" :placeholder=\"$t('lang.inputCode')\"  style=\"margin-top: 15px;\"><span slot=\"prepend\">{{$t(\"lang.password\")}}</span></Input>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div v-show=\"qrcodeImg !== ''\" style=\"text-align: center; margin-top: 15px;\">\n\t\t\t\t\t\t<img :src=\"qrcodeImg\" alt=\"qrcode-img\" />\n\t\t\t\t\t\t<!-- <div class=\"qrcode\" ref=\"qrCodeUrl\"></div> -->\n\t\t\t\t\t</div>\n\t\t\t\t\t<Button @click=\"runAuth()\" type=\"primary\" style=\"margin-top: 15px; margin-right: 10px; \">{{$t(\"lang.confirm\")}}</Button>\n\t\t\t\t\t<Button @click=\"cancelAuth(false)\" style=\"margin-top: 15px; margin-right: 10px; \">{{$t(\"lang.cancel\")}}</Button>\n\t\t\t\t\t<div class=\"layout\" style=\"margin-top: 20px\">\n\t\t\t\t\t\t<a href=\"javascript:void(0)\" @click=\"qrcodeImg = '';authByPwd = true;\" style=\"margin-right: 10px; font-size: 16px;\"><Icon type=\"md-code\" style=\"margin-right: 5px;\"/>Google</a>\n\t\t\t\t\t\t<a href=\"javascript:void(0)\" @click=\"initAuth()\" style=\"margin-right: 10px; font-size: 16px;\"><Icon type=\"md-mail\" style=\"margin-right: 5px;\"/>{{$t(\"lang.email\")}}</a>\n\t\t\t\t\t\t<a :disabled=\"qrcodeImg !== ''\" href=\"javascript:void(0)\" @click=\"initQRCodeImg()\" style=\"margin-right: 10px; font-size: 16px;\"><Icon type=\"md-qr-scanner\" style=\"margin-right: 5px;\"/>{{$t(\"lang.qrcode\")}}</a>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</Modal>\n\t\t</div>\n\t</div>\n</template>\n<script>\n\timport {webResponse} from '../toolchain/help.js';\n    export default {\n\t\tinject: [\"reload\"],\n        data () {\n            return {\n\t\t\t\tuser: null,\n\t\t\t\tuserID: '',\n\t\t\t\tauthMail: '',\n\t\t\t\tauthCode: '',\n\t\t\t\tshowModal: false,\n\t\t\t\tauthModal: false,\n\t\t\t\tauthByPwd: false,\n\t\t\t\t\n\t\t\t\tqrcodeAuth: false,\n\t\t\t\tjustVerifyEmail: false,\n\t\t\t\t\n\t\t\t\tisPage: false,\n\t\t\t\tqrcodeImg: '',\n\t\t\t\tcodetimer: null,\n\t\t\t\tredirectUrl: '/',\n            }\n\t\t},\n\t\tprops: {\n\t\t\tonAuthSuccessed: {\n\t\t\t\ttype: Function,\n\t\t\t\tdefault: null\n\t\t\t},\n\t\t\tonUserOff: {\n\t\t\t\ttype: Function,\n\t\t\t\tdefault: null\n\t\t\t},\n\t\t},\n        mounted:function(){\n\t\t\tvar cacheEmail = localStorage.getItem('authMail');\n\t\t\tif (cacheEmail !== undefined && cacheEmail !== null && typeof(cacheEmail) === 'string') {\n\t\t\t\tthis.authMail = cacheEmail;\n\t\t\t\tconsole.log(this.authMail)\n\t\t\t}\n\t\t\tconsole.log(this.$route)\n\t\t\t\n\t\t\tif (window.location.href.indexOf('/auth') > -1) {\n\t\t\t\tthis.isPage = true;\n\t\t\t\tif (this.$route.query.redirectUrl !== undefined) this.redirectUrl = this.$route.query.redirectUrl;\n\t\t\t\tthis.runModal(this.$route.query.email)\n\t\t\t}\n        },\n        methods: {\n\t\t\tgetUser() {\n\t\t\t\treturn this.user;\n\t\t\t},\n\t\t\trunModal(email) {\n\t\t\t\tif (email !== undefined && email !== null && email !== '') this.justVerifyEmail = true;\n\t\t\t\tif (this.authMail === '') this.authMail = email;\n\t\t\t\tthis.showModal = true;\n\t\t\t\tthis.authModal = true;\n\t\t\t},\n\t\t\tcancelAuth(bSuccessed) {\n\t\t\t\tif (this.isPage === true) {\n\t\t\t\t\tif (bSuccessed === true) window.location.href = this.redirectUrl;\n\t\t\t\t} else {\n\t\t\t\t\tif (this.justVerifyEmail === false) localStorage.removeItem('isLogin');\n\t\t\t\t\tif (this.codetimer !== null) clearInterval(this.codetimer);\n\t\t\t\t\tthis.justVerifyEmail = false;\n\t\t\t\t\tthis.showModal = false;\n\t\t\t\t\tthis.authModal = false;\n\t\t\t\t\tthis.authCode = '';\n\t\t\t\t}\n\t\t\t},\n\t\t\tupdateUser(response) {\n\t\t\t\tlet authResult = false;\n\t\t\t\tif (response === null) {\n\t\t\t\t\tthis.user = null;\n\t\t\t\t\tlocalStorage.removeItem('authMail');\n\t\t\t\t\tif (this.onUserOff !== null && this.onUserOff !== undefined) this.onUserOff(response);\n\t\t\t\t} else {\n\t\t\t\t\tauthResult = true;\n\t\t\t\t\tthis.user = response.data['Data'];\n\t\t\t\t\tlocalStorage.setItem('isLogin', 'true');\n\t\t\t\t\tlocalStorage.setItem('authMail', this.authMail);\n\t\t\t\t\tif (this.onAuthSuccessed !== null && this.onAuthSuccessed !== undefined) this.onAuthSuccessed(response);\n\t\t\t\t}\n\t\t\t\tthis.cancelAuth(authResult);\n\t\t\t},\n\t\t\t// 这里的onUserOnline和onUserOff仅用于临时回调\n\t\t\tcheckStatus(onAuthSuccessed, onUserOff, random) {\n\t\t\t\tlet self = this;\n\t\t\t\tlet getUrl = '/api/user/status';\n\t\t\t\tif (random !== undefined && random !== null && random !== '') getUrl = getUrl + '?random=' + random;\n\t\t\t\tthis.httpGet(getUrl, function(response){\n\t\t\t\t\twebResponse(response, function(err){\n\t\t\t\t\t\tconsole.log(err)\n\t\t\t\t\t\tself.$Message.error(err)\n\t\t\t\t\t\tself.updateUser(null);\n\t\t\t\t\t\tif (onUserOff !== null && onUserOff !== undefined) onUserOff(response);\n\t\t\t\t\t}, function(response){\n\t\t\t\t\t\tself.updateUser(response);\n\t\t\t\t\t\tif (onAuthSuccessed !== null && onAuthSuccessed !== undefined) onAuthSuccessed(response);\n\t\t\t\t\t})\n\t\t\t\t})\n\t\t\t},\n\t\t\tlogoutUser() {\n\t\t\t\tlet self = this;\n\t\t\t\tthis.httpGet('/api/user/logout', function(response){\n\t\t\t\t\tself.updateUser(null);\n\t\t\t\t}, function(response){\n\t\t\t\t\tself.updateUser(null);\n\t\t\t\t})\n\t\t\t},\n\t\t\tinitAuth() {\n\t\t\t\tthis.authByPwd = false;\n\t\t\t\tthis.qrcodeImg = '';\n\t\t\t},\n\t\t\tauthCodeSend() {\n\t\t\t\tif (this.checkAuthEmail() === false) return;\n\n\t\t\t\tlet timeCount = 0;\n\t\t\t\tdocument.getElementById(\"authBtn\").disabled = true;\n\t\t\t\tlet oldName = document.getElementById(\"authBtn\").innerHTML;\n\t\t\t\tlet timer = setInterval(()=> {\n\t\t\t\t\tif (timeCount < 60000) {\n\t\t\t\t\t\tif (document.getElementById(\"authBtn\") === undefined || document.getElementById(\"authBtn\") === null) {\n\t\t\t\t\t\t\tclearInterval(timer);\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tdocument.getElementById(\"authBtn\").innerHTML = (60000 - timeCount) / 1000 + 's ' + this.$t('lang.retry')\n\t\t\t\t\t\ttimeCount = timeCount + 1000;\n\t\t\t\t\t\treturn\n\t\t\t\t\t}\n\t\t\t\t\tclearInterval(timer);\n\t\t\t\t\tdocument.getElementById(\"authBtn\").disabled = false;\n\t\t\t\t\tdocument.getElementById(\"authBtn\").innerHTML = oldName;\n\t\t\t\t}, 1000)\n\n\t\t\t\tlet self = this;\n\t\t\t\tlet formdata = new FormData();\n\t\t\t\tformdata.append('kind', 'send');\n\t\t\t\tformdata.append('authID', this.authMail);\n\t\t\t\tthis.httpPost('/api/user/auth', formdata, function(response){\n\t\t\t\t\twebResponse(response, function(err){\n\t\t\t\t\t\tself.$Message.error(err)\n\t\t\t\t\t})\n\t\t\t\t})\n\t\t\t},\n\t\t\trunAuth() {\n\t\t\t\tif (this.checkAuthEmail() === false) return;\n\n\t\t\t\tlet self = this;\n\t\t\t\tlet formdata = new FormData();\n\t\t\t\tlet postUrl = '/api/user/auth';\t\t\t\t\n\t\t\t\tformdata.append('kind', 'verify');\n\t\t\t\tformdata.append('authID', this.authMail);\n\t\t\t\tformdata.append('pwd', this.authCode);\n\t\t\t\tformdata.append('justVerify', this.justVerifyEmail);\n\t\t\t\tthis.httpPost(postUrl, formdata, function(response){\n\t\t\t\t\twebResponse(response, function(err){self.$Message.error(err)}, self.authSuccessed)\n\t\t\t\t})\n\t\t\t},\n\t\t\tauthSuccessed(response) {\n\t\t\t\tconsole.log(response, this.justVerifyEmail)\n\t\t\t\tthis.$Message.success(this.$t('lang.authTitle') + this.$t('lang.successed'));\n\t\t\t\tif (this.justVerifyEmail === true) {\n\t\t\t\t\tif (this.codetimer !== null) clearInterval(this.codetimer);\n\t\t\t\t\tthis.justVerifyEmail = false;\n\t\t\t\t\tthis.showModal = false;\n\t\t\t\t\tthis.authModal = false;\n\t\t\t\t\tif (this.onAuthSuccessed !== null && this.onAuthSuccessed !== undefined) this.onAuthSuccessed(response);\n\t\t\t\t\treturn\n\t\t\t\t}\n\t\t\t\tthis.updateUser(response);\n\t\t\t},\n\t\t\tcheckAuthEmail() {\n\t\t\t\tlet authMail = this.authMail;\n\t\t\t\tif (this.authMail === undefined || this.authMail === null) authMail = '';\n\t\t\t\tlet isInvalidEmail = authMail !== '' && authMail.indexOf('@') === -1;\n\t\t\t\tif (authMail === '' || isInvalidEmail) {\n\t\t\t\t\tthis.$Message.error(this.$t('lang.inputEmail'));\n\t\t\t\t\treturn false\n\t\t\t\t}\n\t\t\t\treturn true;\n\t\t\t},\n\t\t\tinitQRCodeImg() {\n\t\t\t\tif (this.checkAuthEmail() === false) return;\n\n\t\t\t\tlet self = this;\n\t\t\t\tlet formdata = new FormData();\n\t\t\t\tformdata.append('kind', 'qrcode');\n\t\t\t\tformdata.append('authID', this.authMail);\n\t\t\t\tthis.httpPost('/api/user/auth', formdata, function(response){\n\t\t\t\t\twebResponse(response, function(err){self.$Message.error(err)}, self.updateQRCodeImg)\n\t\t\t\t})\n\t\t\t},\n\t\t\tupdateQRCodeImg(response) {\n\t\t\t\tthis.qrcodeImg = response.data['Data'];\n\t\t\t},\n\t\t\thttpGet(url, onResponse, onPanic) {\n\t\t\t\tthis.$axios.get(url)\n\t\t\t\t.then(function (response) {\n\t\t\t\t\tif (onResponse !== undefined && onResponse !== null) onResponse(response);\n\t\t\t\t})\n\t\t\t\t.catch(function (response) {\n\t\t\t\t\tif (onPanic !== undefined && onPanic !== null) onPanic(response);\n\t\t\t\t});\n\t\t\t},\n\t\t\thttpPost(url, formdata, onResponse, onPanic) {\n\t\t\t\tthis.$axios.post(url, formdata)\n\t\t\t\t.then(function (response) {\n\t\t\t\t\tif (onResponse !== undefined && onResponse !== null) onResponse(response);\n\t\t\t\t})\n\t\t\t\t.catch(function (response) {\n\t\t\t\t\tif (onPanic !== undefined && onPanic !== null) onPanic(response);\n\t\t\t\t});\n\t\t\t}\n        }\n    }\n    </script>"]}]}